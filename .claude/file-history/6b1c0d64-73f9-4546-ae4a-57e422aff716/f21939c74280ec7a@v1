import { Avatar, AvatarFallback } from '@/components/ui/avatar';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip';
import type { ConversationListItem } from '@/types';
import { Link } from '@inertiajs/react';
import { Archive, Computer } from 'lucide-react';

export function InboxListItem({
    item,
    selected,
    onSelect,
    onToggleArchive,
}: {
    item: ConversationListItem;
    selected: boolean;
    onSelect: () => void;
    onToggleArchive: () => void;
}) {
    const href = item.id === 'system' ? '/inbox/system' : `/inbox/conversations/${item.id}`;

    return (
        <Link
            href={href}
            prefetch
            className={`hover:bg-accent flex cursor-pointer items-center gap-3 rounded-md p-3 ${selected ? 'bg-accent' : ''}`}
            onClick={onSelect}
        >
            {item.id === 'system' ? (
                <Computer className="text-muted-foreground m-1.5 h-5 w-5" />
            ) : (
                <Avatar className="h-8 w-8">
                    <AvatarFallback>{item.title.slice(0, 2).toUpperCase()}</AvatarFallback>
                </Avatar>
            )}
            <div className="min-w-0 flex-1">
                <div className="flex items-center justify-between gap-2">
                    <div className="flex min-w-0 flex-1 items-center gap-2">
                        <div className="truncate font-medium">{item.title}</div>
                        {item.unreadCount > 0 && <Badge className="flex-shrink-0">{item.unreadCount > 99 ? '99+' : item.unreadCount}</Badge>}
                    </div>
                    <div className="flex flex-shrink-0 items-center gap-2">
                        {item.archived && (
                            <Badge variant="secondary" className="gap-1">
                                <Archive className="h-3 w-3" />
                                Archived
                            </Badge>
                        )}
                        <div className="text-muted-foreground text-xs">{item.lastActivityAt}</div>
                    </div>
                </div>
                <div className="text-muted-foreground truncate text-sm">{item.subtitle}</div>
            </div>
            {item.id !== 'system' && (
                <TooltipProvider>
                    <Tooltip>
                        <TooltipTrigger asChild>
                            <Button
                                variant="ghost"
                                size="icon"
                                className="ml-1"
                                onClick={(e) => {
                                    e.preventDefault();
                                    e.stopPropagation();
                                    onToggleArchive();
                                }}
                                aria-label={item.archived ? 'Unarchive conversation' : 'Archive conversation'}
                            >
                                <Archive className="h-4 w-4" />
                            </Button>
                        </TooltipTrigger>
                        <TooltipContent>{item.archived ? 'Unarchive conversation' : 'Archive conversation'}</TooltipContent>
                    </Tooltip>
                </TooltipProvider>
            )}
        </Link>
    );
}

export default InboxListItem;
